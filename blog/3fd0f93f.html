<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <!-- æ–°å¢githubçš„å…³æ³¨æ ·å¼ - ->
  <a href="https://github.com/longshilin"><img style="position: absolute; top: 35px; right: 0; border: 0;" src="https://longshilin.com/blog/images/forkme_right_green_007200.png" alt="Fork me on GitHab"></a>-->
  <title>4 åŸºäºHadoopçš„å¹³å°æ­å»ºä¸MapReduceä½œä¸šè®¾è®¡ | ç§¯ä¹‹åœ¨å¹³æ—¥</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="4.1 åŸºäºHadoopçš„ä¼ªåˆ†å¸ƒå¼å¹³å°æ­å»º åœ¨æ­å»ºHadoopåˆ†å¸ƒå¼ç³»ç»Ÿå¹³å°[1]æ—¶ï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§æ–¹å¼å¯ä»¥é€‰æ‹©ï¼Œåˆ†åˆ«æ˜¯ä¼ªåˆ†å¸ƒçš„æ¨¡å¼å’Œå®Œå…¨åˆ†å¸ƒå¼æ¨¡å¼ã€‚è¿™ä¸¤ç§æ¨¡å¼çš„ä¸»è¦åŒºåˆ«åœ¨äºå‰è€…æ˜¯åœ¨æœ¬åœ°ä¸€å°æœºå™¨ä¸­è¿è¡ŒHadoopæ¡†æ¶ä¸­çš„å„ç§æœåŠ¡ï¼Œæ˜¯ä¸€ç§æ¨¡æ‹Ÿåˆ†å¸ƒå¼çš„é›†ç¾¤ç¯å¢ƒã€‚è€Œå®Œå…¨åˆ†å¸ƒå¼çš„ç¯å¢ƒå°±æ˜¯åœ¨çœŸå®çš„å¤šä¸ªä¸»æœºä¸Šé…ç½®Hadoopï¼Œå¹¶æ­å»ºæ•´ä¸ªé›†ç¾¤ç¯å¢ƒã€‚">
<meta name="keywords" content="Hadoop,å¤§æ•°æ®,åŸºå› æµ‹åº,æ¯•ä¸šè®¾è®¡">
<meta property="og:type" content="article">
<meta property="og:title" content="4 åŸºäºHadoopçš„å¹³å°æ­å»ºä¸MapReduceä½œä¸šè®¾è®¡">
<meta property="og:url" content="https://longshilin.com/blog/3fd0f93f.html">
<meta property="og:site_name" content="ç§¯ä¹‹åœ¨å¹³æ—¥">
<meta property="og:description" content="4.1 åŸºäºHadoopçš„ä¼ªåˆ†å¸ƒå¼å¹³å°æ­å»º åœ¨æ­å»ºHadoopåˆ†å¸ƒå¼ç³»ç»Ÿå¹³å°[1]æ—¶ï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§æ–¹å¼å¯ä»¥é€‰æ‹©ï¼Œåˆ†åˆ«æ˜¯ä¼ªåˆ†å¸ƒçš„æ¨¡å¼å’Œå®Œå…¨åˆ†å¸ƒå¼æ¨¡å¼ã€‚è¿™ä¸¤ç§æ¨¡å¼çš„ä¸»è¦åŒºåˆ«åœ¨äºå‰è€…æ˜¯åœ¨æœ¬åœ°ä¸€å°æœºå™¨ä¸­è¿è¡ŒHadoopæ¡†æ¶ä¸­çš„å„ç§æœåŠ¡ï¼Œæ˜¯ä¸€ç§æ¨¡æ‹Ÿåˆ†å¸ƒå¼çš„é›†ç¾¤ç¯å¢ƒã€‚è€Œå®Œå…¨åˆ†å¸ƒå¼çš„ç¯å¢ƒå°±æ˜¯åœ¨çœŸå®çš„å¤šä¸ªä¸»æœºä¸Šé…ç½®Hadoopï¼Œå¹¶æ­å»ºæ•´ä¸ªé›†ç¾¤ç¯å¢ƒã€‚">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://i.imgur.com/kBOP38U.png">
<meta property="og:image" content="https://i.imgur.com/NvL3uNw.png">
<meta property="og:image" content="https://i.imgur.com/BRr8fqM.png">
<meta property="og:image" content="https://i.imgur.com/Oa91nGQ.png">
<meta property="og:image" content="https://i.imgur.com/aLtO039.png">
<meta property="og:image" content="https://i.imgur.com/SdyGul2.png">
<meta property="og:updated_time" content="2018-11-11T12:42:48.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="4 åŸºäºHadoopçš„å¹³å°æ­å»ºä¸MapReduceä½œä¸šè®¾è®¡">
<meta name="twitter:description" content="4.1 åŸºäºHadoopçš„ä¼ªåˆ†å¸ƒå¼å¹³å°æ­å»º åœ¨æ­å»ºHadoopåˆ†å¸ƒå¼ç³»ç»Ÿå¹³å°[1]æ—¶ï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§æ–¹å¼å¯ä»¥é€‰æ‹©ï¼Œåˆ†åˆ«æ˜¯ä¼ªåˆ†å¸ƒçš„æ¨¡å¼å’Œå®Œå…¨åˆ†å¸ƒå¼æ¨¡å¼ã€‚è¿™ä¸¤ç§æ¨¡å¼çš„ä¸»è¦åŒºåˆ«åœ¨äºå‰è€…æ˜¯åœ¨æœ¬åœ°ä¸€å°æœºå™¨ä¸­è¿è¡ŒHadoopæ¡†æ¶ä¸­çš„å„ç§æœåŠ¡ï¼Œæ˜¯ä¸€ç§æ¨¡æ‹Ÿåˆ†å¸ƒå¼çš„é›†ç¾¤ç¯å¢ƒã€‚è€Œå®Œå…¨åˆ†å¸ƒå¼çš„ç¯å¢ƒå°±æ˜¯åœ¨çœŸå®çš„å¤šä¸ªä¸»æœºä¸Šé…ç½®Hadoopï¼Œå¹¶æ­å»ºæ•´ä¸ªé›†ç¾¤ç¯å¢ƒã€‚">
<meta name="twitter:image" content="https://i.imgur.com/kBOP38U.png">
<meta name="twitter:creator" content="@yilong0722">
<link rel="publisher" href="106698639613319710000">
  
    <link rel="alternate" href="/blog/atom.xml" title="ç§¯ä¹‹åœ¨å¹³æ—¥" type="application/atom+xml">
  
  
    <link rel="icon" href="/images/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" integrity="sha384-XdYbMnZ/QjLh6iI4ogqCTaIjrFk87ip+ekIjefZch0Y+PvJ8CDYtEs1ipDmPorQ+" crossorigin="anonymous">

  <link rel="stylesheet" href="/blog/css/styles.css">
  

</head>
</html>
<body>
  <nav class="navbar navbar-inverse navbar-wrapper">
  <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#main-menu-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="main-menu-navbar">
      <ul class="nav navbar-nav">
        
          <li><a class="" href="/blog/">Home</a></li>
        
          <li><a class="" href="/blog/../wiki/">Wiki</a></li>
        
          <li><a class="" href="/blog/DevOps/">DevOps</a></li>
        
          <li><a class="" href="/blog/Sequencing/">Gene Sequencing Project</a></li>
        
          <li><a class="" href="/blog/archives/">Archives</a></li>
        
          <li><a class="" href="/blog/1233/">ğŸ’—</a></li>
        
          <li><a class="" href="/blog/Daily-Plan/">Daily Plan</a></li>
        
      </ul>


      <ul class="nav navbar-nav navbar-right" id="sub-menu-navbar">
        
          <li><a href="/blog/atom.xml" title="RSS Feed"><i class="fa fa-rss"></i></a></li>
        
        
          <li><a href="https://github.com/longshilin" title="Github"><i class="fa fa-github"></i></a></li>
        
        
          <li><a href="https://gitlab.com/longshilin" title="Gitlab"><i class="fa fa-gitlab"></i></a></li>
        
        
          <li><a href="https://stackoverflow.com/users/7739839" title="StackOverFlow"><i class="fa fa-stack-overflow"></i></a></li>
        
        
          <li><a href="https://zh.wikipedia.org/wiki/User:Longshilin" title="wikipedia"><i class="fa fa-wikipedia-w"></i></a></li>
        
      </ul>

<!-- add google translate - ->
      <div id="google_translate_element" style="position:absolute; right:0; margin-top: 8px; margin-right: 1px;"></div>

      <script type="text/javascript">
        function googleTranslateElementInit() {
          new google.translate.TranslateElement({pageLanguage: 'zh-CN', layout: google.translate.TranslateElement.FloatPosition.TOP_RIGHT, multilanguagePage: true, gaTrack: true, gaId: 'UA-125053144-2'}, 'google_translate_element');
        }
      </script><script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
<!- - /add google translate -->

    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>

  <div class="container">
    <div class="blog-header hidden-xs">
  <img id="blog-logo" width="80" height="80" alt="Long Shilin" src="https://www.gravatar.com/avatar/06c71e5f94c268040fd4068f336188e7.png">
  <h2 class="blog-title">ç§¯ä¹‹åœ¨å¹³æ—¥</h2>
  
    <p class="lead blog-description">AWS, DevOps, IT Infrastructure, and Other Puzzles</p>
  
</div>
<div class="blog-header visible-xs">
  <h1 class="blog-title"></h1>
  
    <p class="lead blog-description"></p>
  
</div>

    <div class="row">
        <div class="col-sm-8 blog-main" id="main-body">
          <article id="post-åŸºå› æµ‹åº/Hadoop-based-platform-construction-and-MapReduce-job-design" class="article article-type-post" itemscope="" itemprop="blogPost">

  <header class="article-header">
    
  
    <h1 class="article-title" itemprop="name">
      4 åŸºäºHadoopçš„å¹³å°æ­å»ºä¸MapReduceä½œä¸šè®¾è®¡
    </h1>
  


  </header>

  <div class="article-meta">
    
    <div class="article-datetime">
  <a href="/blog/3fd0f93f.html" class="article-date"><time datetime="2018-07-23T00:00:00.000Z" itemprop="datePublished">2018-07-23</time></a>
</div>

    
    
  <div class="article-category">
    <a class="article-category-link" href="/blog/categories/HadoopåŸºå› æµ‹åº/">HadoopåŸºå› æµ‹åº</a>
  </div>


    
      
        <a href="https://longshilin.com/blog/3fd0f93f.html#disqus_thread" class="article-comment-link">
          <i class="fa fa-comment"></i> è¯„è®º
        </a>
      
    
  </div>
  <div class="article-inner">

    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="4-1-åŸºäºhadoopçš„ä¼ªåˆ†å¸ƒå¼å¹³å°æ­å»º">4.1 åŸºäºHadoopçš„ä¼ªåˆ†å¸ƒå¼å¹³å°æ­å»º</h2>
<p>åœ¨æ­å»ºHadoopåˆ†å¸ƒå¼ç³»ç»Ÿå¹³å°<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup>æ—¶ï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§æ–¹å¼å¯ä»¥é€‰æ‹©ï¼Œåˆ†åˆ«æ˜¯ä¼ªåˆ†å¸ƒçš„æ¨¡å¼å’Œå®Œå…¨åˆ†å¸ƒå¼æ¨¡å¼ã€‚è¿™ä¸¤ç§æ¨¡å¼çš„ä¸»è¦åŒºåˆ«åœ¨äºå‰è€…æ˜¯åœ¨æœ¬åœ°ä¸€å°æœºå™¨ä¸­è¿è¡ŒHadoopæ¡†æ¶ä¸­çš„å„ç§æœåŠ¡ï¼Œæ˜¯ä¸€ç§æ¨¡æ‹Ÿåˆ†å¸ƒå¼çš„é›†ç¾¤ç¯å¢ƒã€‚è€Œå®Œå…¨åˆ†å¸ƒå¼çš„ç¯å¢ƒå°±æ˜¯åœ¨çœŸå®çš„å¤šä¸ªä¸»æœºä¸Šé…ç½®Hadoopï¼Œå¹¶æ­å»ºæ•´ä¸ªé›†ç¾¤ç¯å¢ƒã€‚</p>
<a id="more"></a>
<h3 id="4-1-1-æ­å»ºhadoopä¼ªåˆ†å¸ƒå¼å¹³å°">4.1.1 æ­å»ºHadoopä¼ªåˆ†å¸ƒå¼å¹³å°</h3>
<p>ä½¿ç”¨åˆ†å¸ƒå¼çš„ç¯å¢ƒå¯¹å…¨åŸºå› ç»„æµ‹åºçš„ç¯å¢ƒè¿›è¡Œæ­å»ºï¼Œä¸‹é¢ä»‹ç»æ•´ä¸ªåˆ†å¸ƒå¼ç¯å¢ƒçš„æ­å»ºæµç¨‹ã€‚<br>
<img src="https://i.imgur.com/kBOP38U.png" alt="å›¾4-1 Hadoopä¼ªåˆ†å¸ƒå¼é›†ç¾¤æ¶æ„å›¾"></p>
<p>1ï¼‰å®‰è£…å¹¶æ£€æŸ¥Javaç‰ˆæœ¬<br>
å¿…é¡»ç¡®ä¿Hadoopé›†ç¾¤å®‰è£…çš„æ˜¯åˆé€‚ç‰ˆæœ¬çš„Javaã€‚å¯ä»¥é€šè¿‡Hadoop wikiç•Œé¢<a href="http://wiki.apache.org/hsdoop/HadoopJavaVersions" target="_blank" rel="noopener">Hadoop wikiç•Œé¢</a>æ¥æŸ¥çœ‹å…·ã€‚é€šè¿‡é”®å…¥ä»¥ä¸‹å‘½ä»¤ï¼ŒæŸ¥çœ‹æœ¬æœºçš„javaç‰ˆæœ¬ä¿¡æ¯ï¼š</p>
<pre><code>elon@longsl:~$ java -version
java version &quot;1.8.0_161&quot;
Java(TM) SE Runtime Environment (build 1.8.0_161-b12)
Java HotSpot(TM) 64-Bit Server VM (build 25.161-b12, mixed mode)
</code></pre>
<p>2ï¼‰åˆ›å»ºUnixç”¨æˆ·è´¦å·<br>
æœ€å¥½åˆ›å»ºç‰¹å®šçš„Unixç”¨æˆ·è´¦å·ä»¥åŒºåˆ†å„Hadoopè¿›ç¨‹ï¼ŒåŠåŒºåˆ†åŒä¸€æœºå™¨ä¸Šçš„å…¶ä»–æœåŠ¡ã€‚åœ¨æˆ‘çš„ä¸»æœºä¸Šï¼Œæˆ‘åˆ›å»ºä¸€ä¸ªåå«elonçš„ç”¨æˆ·åæ¥æ‰§è¡ŒHadoopç¨‹åºã€‚</p>
<p>3ï¼‰å®‰è£…Hadoop<br>
ä»<a href="http://hadoop.apache.org/common/realease.html" target="_blank" rel="noopener">Apache Hadoopå‘å¸ƒé¡µ</a>ä¸‹è½½ä¸€ä¸ªç¨³å®šç‰ˆçš„äºŒè¿›åˆ¶å‘å¸ƒç‰ˆæœ¬åŒ…ï¼ˆé€šå¸¸æ‰“åŒ…ä¸ºä¸€ä¸ªtar.gzç»“å°¾çš„æ–‡ä»¶ï¼‰ï¼Œå†è§£å‹ç¼©åˆ°æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿã€‚åœ¨æˆ‘çš„ä¸»æœºä¸Šæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å³å¯ï¼š<br>
<code>elon@longsl:~$ tar -zxvf hadoop-2.7.6.tar.gz -C .</code></p>
<p>4ï¼‰SSHé…ç½®<br>
SSHå…å¯†ç ç™»å½•çš„åŸç†æ˜¯é¦–å…ˆåœ¨ä¸»æœºAçš„æœ¬åœ°ç”Ÿæˆå…¬é’¥å’Œç§é’¥ï¼Œç„¶åå°†æœ¬æœºçš„å…¬é’¥å‘é€åˆ°è¦å…å¯†ç™»å½•çš„ä¸»æœºä¸Šï¼Œç„¶ååœ¨è®¿é—®ç›®çš„ä¸»æœºæ—¶ï¼Œæœ¬æœºçš„ç§é’¥å’Œç›®çš„ä¸»æœºä¸­çš„å…¬é’¥é…å¯¹æˆåŠŸï¼Œå³å¯ä»¥å…å¯†ç™»å½•ã€‚<br>
åœ¨æœ¬æ¬¡ä¼ªåˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼Œåªéœ€é…ç½®æœ¬æœºç”¨æˆ·è‡ªå·±å’Œè‡ªå·±å…å¯†ç™»é™†ä»¥åŠè‡ªå·±å’Œlocalhostç”¨æˆ·å…å¯†ç™»é™†å³å¯ã€‚æˆ‘æœ¬æœºçš„ä¸»æœºåä¸ºlongslï¼Œå› æ­¤æˆ‘éœ€è¦ä¸ºlongslç”¨æˆ·ç”Ÿæˆå…¬ç§å¯†é’¥å¯¹:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">elon@longsl:~$ ssh-keygen -t rsa</span><br><span class="line"><span class="meta">#</span> å¹¶ä¸”é…ç½®ssh longslå’Œssh localhostèƒ½å…å¯†ç™»é™†:</span><br><span class="line">elon@longsl:~$ ssh-copy-id longsl</span><br><span class="line">elon@longsl:~$ ssh-copy-id localhost</span><br></pre></td></tr></table></figure>
<p>5ï¼‰é…ç½®Hadoop<br>
Hadoopé›†ç¾¤çš„é…ç½®æ–‡ä»¶åœ¨$HADOOP_HOME/etc/hadoopç›®å½•ä¸‹ï¼Œä¸»è¦ä¿®æ”¹äº”ä¸ªé…ç½®æ–‡ä»¶ï¼Œåˆ†åˆ«æ˜¯slavesã€core-site.xmlã€hdfs-site.xmlã€mapred-site.xmlå’Œyarn-site.xmlã€‚<br>
ä¿®æ”¹slavesæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶è¡¨æ˜è¯¥é›†ç¾¤ä¸­çš„å­èŠ‚ç‚¹çš„ä¸»æœºåï¼Œåœ¨ä¼ªåˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼Œç›´æ¥å°†localhostæ·»åŠ è¿›å»å³å¯ã€‚<br>
é…ç½®core-site.xmlï¼Œä¸»è¦è®¾ç½®NameNodeè¿è¡Œçš„ä¸»æœºä¿¡æ¯ã€‚</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>fs.defaultFS<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://longsl:8080/<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- æŒ‡å®šhadoopè¿è¡Œæ—¶äº§ç”Ÿæ–‡ä»¶çš„å­˜å‚¨ç›®å½• --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.tmp.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>/home/elon/hadoop/tmp<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- é…ç½®hdfs-site.xmlï¼Œéœ€è¦è®¾ç½®çš„dfs.replicationçš„å‚æ•°ï¼Œä¸»è¦ç”¨äºè®¾ç½®é›†ç¾¤ä¸­å‰¯æœ¬çš„ä¸ªæ•°ï¼Œç”±äºè¿™ä¸ªæ˜¯ä¼ªåˆ†å¸ƒæ¨¡å¼ï¼Œå› æ­¤å‰¯æœ¬æ•°è®¾ç½®ä¸º1å³å¯ã€‚ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.replication<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>é…ç½®mapred-site.xmlï¼Œé¦–å…ˆè®¾ç½®äº†æ—¥å¿—èšåˆç›¸å…³çš„å‚æ•°é…ç½®ï¼Œæˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºå°†é›†ç¾¤ç¯å¢ƒä¸­åŸæœ¬å­˜å‚¨äºç³»ç»Ÿtmpç›®å½•ä¸‹çš„ä½œä¸šè¿è¡Œæ—¥å¿—ä½œäº†å½’æ¡£å¤„ç†ï¼Œå¹¶å­˜å‚¨åœ¨äº†HDFSä¸Šã€‚æ¥ä¸‹æ¥ï¼Œå¯¹é›†ç¾¤ä¸­åœ¨å„ä¸ªå®¹å™¨ä¸­ä½œä¸šçš„è¿è¡Œç¯å¢ƒåšäº†ç›¸åº”çš„é…ç½®ï¼Œå…·ä½“æ˜¯è®¾ç½®äº†æ¯ä¸ªä½œä¸šåœ¨mapé˜¶æ®µå’Œreduceé˜¶æ®µèƒ½å¤Ÿè¢«åˆ†é…çš„æœ€å¤§è¿è¡Œå†…å­˜ï¼Œå¦å¤–è®¾ç½®äº†å…¶å¯ä»¥ä½¿ç”¨çš„javaè™šæ‹Ÿæœºçš„æœ€å¤§å†…å­˜èµ„æºæ•°ã€‚æœ€åå¯¹mapé˜¶æ®µå’Œreduceé˜¶æ®µèƒ½å¤Ÿè¢«ä½¿ç”¨çš„CPUæ ¸æ•°åšäº†ç›¸åº”é…ç½®ã€‚</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.framework.name<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>yarn<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- log aggreation --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.jobhistory.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>localhost:10020<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.jobhistory.webapp.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>localhost:19888<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.jobhistory.intermediate-done-dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>/mr-history/done_intermediate<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.jobhistory.done-dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>/mr-history/done<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- configure RAM for a Container --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.map.memory.mb<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>2048<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.reduce.memory.mb<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>2048<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.map.java.opts<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>-Xmx1024m<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.reduce.java.opts<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>-Xmx1024m<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- configure cpu core on map and reduce --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.map.cpu.vcores<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>4<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.reduce.cpu.vcores<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>4<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>é…ç½®yarn-site.xmlï¼Œä¸»è¦éœ€é…ç½®RMè¿è¡Œçš„ä¸»æœºï¼Œåœ¨ä¼ªåˆ†å¸ƒå¼ç¯å¢ƒä¸­å°±æ˜¯æŒ‡æœ¬åœ°ä¸»æœºï¼Œå¦å¤–NMèŠ‚ç‚¹ä¸Šè¿è¡Œçš„æœåŠ¡æ˜¯mapreduce_shuffleï¼Œè¿™ä¸ªé€‰é¡¹æ˜¯å¿…é¡»é…ç½®çš„ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦å¤„ç†çš„å°±æ˜¯mapreduceç¨‹åºã€‚æœ€åå¼€å¯äº†yarnä¸Šçš„æ—¥å¿—èšåˆåŠŸèƒ½ï¼Œå¹¶å°†å„ä¸ªå®¹å™¨ä¸Šäº§ç”Ÿçš„æ—¥å¿—å­˜å‚¨åœ¨HDFSä¸Šã€‚</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.hostname<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>longsl<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.aux-services<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>mapreduce_shuffle<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- log aggreation --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.log-aggregation-enable<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.remote-app-log-dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>/user/container/logs<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>6ï¼‰ç¯å¢ƒè®¾ç½®<br>
éœ€è¦è®¾ç½®Hadoopç³»ç»Ÿçš„Javaå®‰è£…çš„ä½ç½®ï¼Œé€šè¿‡åœ¨etc/hadoop/hadoop-env.shæ–‡ä»¶ä¸­è®¾ç½®JAVA_HOMEé¡¹ã€‚<br>
<code>export JAVA_HOME=/opt/jdk1.8</code></p>
<p>7ï¼‰æ ¼å¼åŒ–HDFSæ–‡ä»¶ç³»ç»Ÿ<br>
åœ¨èƒ½å¤Ÿä½¿ç”¨ä¹‹å‰ï¼Œå…¨æ–°çš„HDFSå®‰è£…éœ€è¦è¿›è¡Œæ ¼å¼åŒ–ã€‚é€šè¿‡åˆ›å»ºå­˜å‚¨ç›®å½•å’Œåˆå§‹ç‰ˆæœ¬çš„namenodeæŒä¹…æ•°æ®ç»“æ„ï¼Œæ ¼å¼åŒ–è¿›ç¨‹å°†åˆ›å»ºä¸€ä¸ªç©ºçš„æ–‡ä»¶ç³»ç»Ÿã€‚æ ¼å¼åŒ–HDFSæ˜¯ä¸€ä¸ªå¿«é€Ÿæ“ä½œï¼Œä»¥hdfsç”¨æˆ·èº«ä»½è¿è¡Œå‘½ä»¤ï¼šhadoop namenode -format</p>
<h3 id="4-1-2-å¯åŠ¨å’Œåœæ­¢hadoopé›†ç¾¤">4.1.2 å¯åŠ¨å’Œåœæ­¢Hadoopé›†ç¾¤</h3>
<p>Hadoopè‡ªå¸¦è„šæœ¬ï¼Œå¯ä»¥è¿è¡Œè„šæœ¬å‘½ä»¤ï¼Œå¯åŠ¨æˆ–è€…åœæ­¢å¦‚hdfsã€yarnæˆ–è€…æ—¥å¿—èšåˆç­‰æœåŠ¡è¿›ç¨‹ã€‚ä¸ºäº†ä½¿ç”¨è¿™äº›è„šæœ¬ï¼Œéœ€è¦å‘Šè¯‰Hadoopé›†ç¾¤ä¸­æœ‰å“ªäº›æœºå™¨ã€‚æ–‡ä»¶slavesç”¨äºæ­¤ç›®çš„ï¼Œè¯¥æ–‡ä»¶åŒ…å«äº†æœºå™¨ä¸»æœºåæˆ–IPåœ°å€çš„åˆ—è¡¨ï¼Œæ¯è¡Œä»£è¡¨ä¸€ä¸ªæœºå™¨ä¿¡æ¯ã€‚æ–‡ä»¶slavesåˆ—ä¸¾äº†å¯ä»¥è¿è¡Œdatanodeå’ŒèŠ‚ç‚¹ç®¡ç†å™¨çš„æœºå™¨ã€‚</p>
<p>1ï¼‰å¯åŠ¨HDFSå®ˆæŠ¤è¿›ç¨‹<br>
<a href="http://xn--elonstart-dfs-lm3uka20b011ffp0dkh7dc9zdt71ahjf.sh" target="_blank" rel="noopener">ä»¥elonç”¨æˆ·èº«ä»½è¿è¡Œå‘½ä»¤start-dfs.sh</a>ï¼Œå¯ä»¥å¯åŠ¨HDFSå®ˆæŠ¤è¿›ç¨‹ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥å‘½ä»¤ä»core-site.xmlé…ç½®é¡¹fs.defaultFSä¸­æ‰¾åˆ°namenodeçš„ä¸»æœºåã€‚æ›´å…·ä½“ä¸€äº›ï¼Œstart-dfs.shè„šæœ¬æ‰€åšçš„äº‹æƒ…å¦‚ä¸‹ï¼š<br>
1)åœ¨æ¯å°æœºå™¨ä¸Šå¯åŠ¨ä¸€ä¸ªnamenodeã€‚<br>
2)åœ¨slavesæ–‡ä»¶åˆ—ä¸¾çš„æ¯å°æœºå™¨ä¸Šå¯åŠ¨ä¸€ä¸ªdatanode<br>
3)åœ¨æ¯å°æœºå™¨ä¸Šå¯åŠ¨ä¸€ä¸ªè¾…åŠ©namenodeã€‚</p>
<p>2ï¼‰å¯åŠ¨YARNå®ˆæŠ¤è¿›ç¨‹<br>
YARNå®ˆæŠ¤è¿›ç¨‹ä»¥ç›¸åŒçš„æ–¹å¼å¯åŠ¨ï¼Œé€šè¿‡ä»¥yarnç”¨æˆ·èº«ä»½åœ¨æ‰˜ç®¡èµ„æºç®¡ç†å™¨çš„æœºå™¨ä¸Šè¿è¡Œå‘½ä»¤ï¼š<a href="http://start-yarn.sh" target="_blank" rel="noopener">start-yarn.sh</a>ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œèµ„æºç®¡ç†å™¨æ€»æ˜¯å’Œstart-yarn.shè„šæœ¬è¿è¡Œåœ¨åŒä¸€æœºå™¨ä¸Šã€‚è„šæœ¬æ˜ç¡®å®Œæˆä»¥ä¸‹äº‹æƒ…ã€‚<br>
1)åœ¨æœ¬åœ°æœºå™¨ä¸Šå¯åŠ¨ä¸€ä¸ªèµ„æºç®¡ç†å™¨ã€‚<br>
2)åœ¨slavesæ–‡ä»¶åˆ—ä¸¾çš„æ¯å°æœºå™¨ä¸Šå¯åŠ¨ä¸€ä¸ªèŠ‚ç‚¹ç®¡ç†å™¨ã€‚</p>
<p>åŒæ ·ï¼Œè¿˜æä¾›äº†stop-dfs.shå’Œstop-yarn.shè„šæœ¬ç”¨äºåœæ­¢ç”±ç›¸åº”çš„å¯åŠ¨è„šæœ¬å¯åŠ¨çš„å®ˆæŠ¤è¿›ç¨‹ã€‚ä¸‹é¢æ˜¯åœ¨æˆ‘çš„é›†ç¾¤ç¯å¢ƒä¸­å¼€å¯é›†ç¾¤ç¯å¢ƒçš„å®ä¾‹ï¼š</p>
<pre><code>elon@longsl:~$ start-dfs.sh &amp;&amp; start-yarn.sh
Starting namenodes on [longsl]
longsl: starting namenode, logging to /home/elon/hadoop/logs/hadoop-elon-namenode-longsl.out
localhost: starting datanode, logging to /home/elon/hadoop/logs/hadoop-elon-datanode-longsl.out
Starting secondary namenodes [0.0.0.0]
0.0.0.0: starting secondarynamenode, logging to /home/elon/hadoop/logs/hadoop-elon-secondarynamenode-longsl.out
starting yarn daemons
starting resourcemanager, logging to /home/elon/hadoop/logs/yarn-elon-resourcemanager-longsl.out
localhost: starting nodemanager, logging to /home/elon/hadoop/logs/yarn-elon-nodemanager-longsl.out
</code></pre>
<h2 id="4-2-ä¼ªåˆ†å¸ƒå¼ç¯å¢ƒçš„mapreduceä½œä¸šæ„å»º">4.2 ä¼ªåˆ†å¸ƒå¼ç¯å¢ƒçš„MapReduceä½œä¸šæ„å»º</h2>
<p><img src="https://i.imgur.com/NvL3uNw.png" alt="å›¾4-2 ä¼ªåˆ†å¸ƒå¼çš„MapReduceä»»åŠ¡æµç¨‹"></p>
<p>ä¼ªåˆ†å¸ƒå¼çš„MapReduceä»»åŠ¡æ‰§è¡Œå›¾å¦‚å›¾4-2æ‰€ç¤ºï¼ŒMapReduceæ¡†æ¶ä¸­å…±åˆ†ä¸ºMapperé˜¶æ®µå’ŒReduceré˜¶æ®µï¼Œæœ¬èŠ‚ä¼šä¸»è¦ç ”ç©¶Mapperå’ŒReducerçš„æµç¨‹æ„é€ ã€‚åœ¨ä¼ªåˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼ŒMapä»»åŠ¡å’ŒReduceä»»åŠ¡æ˜¯ä¸²è¡Œæ‰§è¡Œä¸‹å»çš„ï¼Œå…¶ä¸­å…ˆæ‰§è¡Œå®Œæ‰€æœ‰Mapä»»åŠ¡å†æ‰§è¡ŒReduceä»»åŠ¡ï¼Œå¦å¤–Mapä»»åŠ¡å’ŒReduceä»»åŠ¡éƒ½ä¼šåœ¨æœ¬åœ°æ‰§è¡Œå™¨ä¸­æ‰§è¡Œã€‚</p>
<h3 id="4-2-1-mapperæµç¨‹æ„é€ ">4.2.1 Mapperæµç¨‹æ„é€ </h3>
<p>åœ¨Mapperé˜¶æ®µä¸­ï¼Œé‡ç‚¹å…³æ³¨å•æ ·æœ¬çš„åŸºå› æµ‹åºæµç¨‹ï¼Œä»è€Œå¾—åˆ°å˜å¼‚æ£€æµ‹çš„ä¸­é—´gVCFæ–‡ä»¶ï¼ŒåŸºå› æµ‹åºMapperé˜¶æ®µçš„æµç¨‹å¦‚å›¾4-3æ‰€ç¤ºã€‚</p>
<p><img src="https://i.imgur.com/BRr8fqM.png" alt="å›¾4-3 åŸºå› æµ‹åºMapperé˜¶æ®µçš„æµç¨‹å›¾"></p>
<p>åœ¨ä¸Šå›¾ä¸­ï¼Œä¸»è¦æ˜¯å¯¹Mapperé˜¶æ®µä»è¾“å…¥sample.txtæ–‡æœ¬æ–‡ä»¶å¼€å§‹ï¼Œä¸€ç›´åˆ°è¾“å‡ºç«¯å¾—åˆ°outputè¾“å‡ºæ–‡ä»¶å¹¶æŠŠå¾—åˆ°çš„gVCFæ–‡ä»¶ä¸Šä¼ åˆ°HDFSä¸Šçš„å±•ç¤ºã€‚å…¶ä¸­åœ¨è¾“å…¥çš„æ–‡æœ¬æ–‡ä»¶ä¸­ä¿å­˜çš„æ˜¯æœ¬æ¬¡æµ‹åºä¸­æ ·æœ¬ç»„ä¸­å„æ ·æœ¬çš„åç§°ä¿¡æ¯ï¼Œä½œä¸ºæµ‹åºå¯¹è±¡ä¼ å…¥æ¨¡ç‰ˆæ–‡ä»¶ä¸­ï¼Œåœ¨æ¨¡ç‰ˆå¼•æ“çš„è°ƒç”¨ä¸‹ç”Ÿæˆæµ‹åºå¯æ‰§è¡Œè„šæœ¬ï¼Œç„¶ååœ¨Shellè„šæœ¬æ‰§è¡Œå¼•æ“ä¸­è°ƒç”¨è¯¥è„šæœ¬ï¼Œä»¥è„šæœ¬å‘½ä»¤çš„æ¨¡å¼æ‰§è¡ŒåŸºå› æµ‹åºåˆ†ææµç¨‹ã€‚<br>
åœ¨è„šæœ¬æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œéœ€è¦è®¿é—®HDFSç³»ç»Ÿï¼Œè·å–è¯¥æµ‹åºæ ·æœ¬çš„æ•°æ®æ–‡ä»¶ï¼Œæœ€åç”ŸæˆgVCFæ–‡ä»¶å¹¶ä¸Šä¼ è‡³HDFSä¸Šå­˜å‚¨ã€‚å¦å¤–å¯¹äºMapperçš„è¾“å…¥ç«¯çš„è¾“å‡ºæ–‡æœ¬ï¼Œè®¾è®¡æ˜¯å°†keyè®¾ç½®ä¸ºåŒä¸€ä¸ªï¼Œè¿™æ ·åœ¨reduceç¨‹åºè°ƒç”¨æ—¶ï¼Œå¯ä»¥åœ¨åŒä¸€ä¸ªreduceç¨‹åºä¸­è¯»å–åˆ°ï¼Œè¿™æ ·æ ·æœ¬å°±å¯ä»¥åœ¨åŒä¸€ä¸ªæµ‹åºåˆ†ææµç¨‹ä¸­è¢«è°ƒç”¨ï¼Œå½¢æˆæœ€ç»ˆçš„VCFæ–‡ä»¶ã€‚</p>
<h3 id="4-2-2-reduceræµç¨‹æ„é€ ">4.2.2 Reduceræµç¨‹æ„é€ </h3>
<p>åœ¨Redueré˜¶æ®µï¼Œä¸»è¦ä¾§é‡çš„æ˜¯åŸºå› æµ‹åºçš„å•æ ·æœ¬å˜å¼‚æ£€æµ‹ç»“æœçš„åˆå¹¶ï¼Œå¾—åˆ°æœ€ç»ˆçš„VCFæ–‡ä»¶çš„è¿‡ç¨‹ï¼ŒåŸºå› æµ‹åºReduceé˜¶æ®µæµç¨‹å›¾å¦‚å›¾4-4æ‰€ç¤ºã€‚</p>
<p>åœ¨è¯¥é˜¶æ®µçš„åˆ†ææµç¨‹ä¸­ï¼Œä¸»è¦æ˜¯å°†ä¸Šä¸€æ­¥Mapperäº§ç”Ÿçš„è¾“å‡ºæ–‡ä»¶ä½œä¸ºæ­¤é˜¶æ®µçš„è¾“å…¥æ–‡ä»¶ï¼Œè€Œreduceç¨‹åºå¯¹äºé”®ç›¸åŒçš„å…ƒç´ å’Œç»è¿‡shuffleæ··æ´—ä¹‹ååœ¨åŒä¸€ä¸ªreduceå¯¹è±¡ä¸­å¤„ç†ï¼Œè¿™æ ·å°±å¯ä»¥å°†è¿™ä¸€ç»„æ ·æœ¬ç”Ÿæˆçš„gVCFæ–‡ä»¶ç»Ÿä¸€ä¼ é€’åˆ°reduceç¨‹åºçš„shellåˆ†ææµç¨‹è„šæœ¬ä¸­å¤„ç†ï¼Œå†è°ƒç”¨FreeMarkeræ¨¡æ¿å¼•æ“æ¥ç”Ÿæˆåˆå¹¶gVCFæ–‡ä»¶çš„è„šæœ¬æ–‡ä»¶ï¼Œæœ€åè°ƒç”¨shellè„šæœ¬æ‰§è¡Œå¼•æ“æ¥è°ƒç”¨è¯¥è„šæœ¬æ–‡ä»¶ï¼Œå¾—åˆ°è¯¥ç»„æ ·æœ¬ç»Ÿä¸€çš„å˜å¼‚æ£€æµ‹æ–‡ä»¶ã€‚</p>
<p><img src="https://i.imgur.com/Oa91nGQ.png" alt="å›¾4-4 åŸºå› æµ‹åºReduceé˜¶æ®µæµç¨‹å›¾"></p>
<p>åŒæ ·ï¼Œåœ¨æœ€åéœ€è¦å°†å¾—åˆ°çš„VCFæ–‡ä»¶ä¸Šä¼ è‡³HDFSä¸Šå­˜å‚¨å¹¶åŒæ„ç®¡ç†ï¼Œè¿™æ ·å°±å®Œæˆäº†åŸºå› æµ‹åºçš„å®Œæ•´æµç¨‹ï¼Œä»å•ä¸ªæ ·æœ¬çš„æµ‹åºåˆ†æå¾—åˆ°å˜å¼‚ä½ç‚¹ä¿¡æ¯ï¼Œåˆ°æœ€ååˆå¹¶å„ä¸ªæ ·æœ¬çš„å˜å¼‚ä½ç‚¹ä¿¡æ¯å¾—åˆ°æœ€ç»ˆèƒ½åæ˜ è¯¥ç”Ÿç‰©ç‰©ç§çš„å…¨åŸºå› ç»„å˜å¼‚ä½ç‚¹ä¿¡æ¯é›†åˆã€‚<br>
##4.3 åŸºäºHadoopåˆ†å¸ƒå¼ç¯å¢ƒæ­å»º<br>
åœ¨å¯¹Hadoopå¹³å°çš„åˆ†å¸ƒå¼ç¯å¢ƒçš„æ­å»ºè¿‡ç¨‹ï¼Œå…¶ä¸­çš„Javaç¯å¢ƒé…ç½®ã€ç”¨æˆ·åˆ›å»ºã€HadoopäºŒè¿›åˆ¶åŒ…çš„å®‰è£…ç­‰æ­¥éª¤éƒ½å’Œä¼ªåˆ†å¸ƒå¼çš„æ­å»ºæ–¹å¼ä¸€è‡´ï¼Œä¸»è¦çš„ä¸åŒä¹‹å¤„åœ¨äºå…¶å¯¹Hadoopé…ç½®æ–‡ä»¶çš„é…ç½®ä¸åŒã€‚<br>
###4.3.1 Hadoopåˆ†å¸ƒå¼æ¶æ„<br>
åœ¨æˆ‘çš„Hadoopåˆ†å¸ƒå¼ç¯å¢ƒé…ç½®ä¸­ï¼Œæˆ‘åˆ©ç”¨äº†ä¸‰å°è™šæ‹Ÿæœºæ¥æ¨¡æ‹ŸçœŸå®ä¸»æœºï¼Œä¸‰å°ä¸»æœºçš„ä¸»æœºååˆ†åˆ«æ˜¯node1ã€node2å’Œnode3ï¼Œå…¶ä¸­ä¸€å°ä½œä¸ºMasterä¸»æœºï¼Œå¦å¤–ä¸¤å°ä½œä¸ºslavesä»èŠ‚ç‚¹ã€‚<br>
Hadoopå®Œå…¨åˆ†å¸ƒå¼æ¶æ„å›¾å¦‚å›¾4-5æ‰€ç¤ºï¼Œåœ¨è¯¥å›¾ä¸­ï¼Œä¸»è¦é€šè¿‡é…ç½®é›†ç¾¤ä¸­å„ä¸ªæœºå™¨çš„Javaç¯å¢ƒå˜é‡å’ŒSSHå…å¯†ç™»å½•ï¼Œå¹¶åœ¨å„ä¸ªæœºå™¨ä¸Šé…ç½®Hadoopå¯æ‰§è¡ŒåŒ…å’Œä¿®æ”¹Hadoopé…ç½®æ–‡ä»¶ï¼Œæ­å»ºHadoopåˆ†å¸ƒå¼é›†ç¾¤ç¯å¢ƒã€‚</p>
<p><img src="https://i.imgur.com/aLtO039.png" alt="å›¾4-5 Hadoopå®Œå…¨åˆ†å¸ƒå¼æ¶æ„å›¾"></p>
<h3 id="4-3-2-hadoopå®Œå…¨åˆ†å¸ƒå¼é…ç½®">4.3.2 Hadoopå®Œå…¨åˆ†å¸ƒå¼é…ç½®</h3>
<p>é¦–å…ˆåœ¨node1ä¸Šè¿›è¡Œä¸‹é¢å„é¡¹çš„é…ç½®ï¼Œæœ€åå†å°†å„ä¸ªé…ç½®é¡¹åŒæ­¥å¤åˆ¶åˆ°node2å’Œnode3èŠ‚ç‚¹ä¸Šã€‚</p>
<pre><code>scp /home/node1/hadoop/etc/hadoop/ root@node2:/home/node2/hadoop/etc/Hadoop
scp /home/node1/hadoop/etc/hadoop/ root@node3:/home/node2/hadoop/etc/hadoop
</code></pre>
<p>(1) é…ç½®slavesæ–‡ä»¶<br>
$HADOOP_HOME/etc/Hadoop/slavesæ–‡ä»¶æ˜¯ç”¨æ¥é…ç½®Hadoopé›†ç¾¤ä¸­çš„ä»èŠ‚ç‚¹çš„ä¸»æœºï¼Œå°†é›†ç¾¤ä¸­æ‰€æœ‰çš„ä»èŠ‚ç‚¹éƒ½åœ¨slavesä¸­è¿›è¡Œè®°å½•ï¼Œé€šå¸¸è¿™äº›ä»èŠ‚ç‚¹å°±æ˜¯æ‰¿æ‹…è®¡ç®—ä»»åŠ¡çš„èŠ‚ç‚¹ã€‚åœ¨æˆ‘çš„å®Œå…¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼Œæˆ‘é…ç½®äº†ä¸¤ä¸ªä»èŠ‚ç‚¹ï¼Œä¸€ä¸ªä¸»èŠ‚ç‚¹ã€‚å› æ­¤éœ€å°†ä»èŠ‚ç‚¹çš„ä¸»æœºånode2å’Œnode3å†™å…¥slavesæ–‡ä»¶ä¸­ã€‚è¿›è¡Œå¦‚ä¸‹é…ç½®ï¼š</p>
<pre><code>node2
node3
</code></pre>
<p>(2) é…ç½®core-site.xmlæ–‡ä»¶<br>
åœ¨å¯¹core-site.xmlæ–‡ä»¶è¿›è¡Œé…ç½®æ—¶ï¼ŒæŒ‡å®šnode1ä¸ºMasterä¸»èŠ‚ç‚¹ï¼Œå› æ­¤NameNodeæœåŠ¡å°±æŒ‡å®šåœ¨node1ä¸»æœºä¸Šã€‚è¿›è¡Œå¦‚ä¸‹é…ç½®ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="name">name</span>&gt;</span>fs.defaultFS<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://node1:8080<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.tmp.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>/root/hadoop/tmp<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>(3) é…ç½®hdfs-site.xmlæ–‡ä»¶<br>
åœ¨å¯¹hdfs-site.xmlæ–‡ä»¶è¿›è¡Œé…ç½®æ—¶ï¼Œä¸»è¦å’Œä¼ªåˆ†å¸ƒå¼ä¸åŒçš„åœ°æ–¹åœ¨äºå¯ä»¥æŒ‡å®šå¤šä¸ªå‰¯æœ¬æ•°äº†ï¼Œå…¶å‰¯æœ¬æ•°çš„å¤šå°‘ä»£è¡¨è¿™ä¸ªæ–‡ä»¶ç³»ç»Ÿçš„å¯é ç¨‹åº¦ï¼Œå‰¯æœ¬æ•°è¶Šé«˜è¶Šå¯é ï¼Œä½†ä¸ºäº†å…¼é¡¾å­˜å‚¨èµ„æºå’Œé«˜å¯é æ€§ä¹Ÿä¸èƒ½è®¾ç½®å¤ªé«˜ï¼Œå®˜æ–¹é»˜è®¤çš„å‰¯æœ¬æ•°æ˜¯3ã€‚å¦å¤–æˆ‘ä»¬å¯ä»¥å¯¹namenodeå’Œdatanodeçš„å­˜å‚¨åœ°å€è¿›è¡Œè‡ªå®šä¹‰ï¼Œæœ€åæŒ‡å®šNameNodeçš„è¾…åŠ©è¿›ç¨‹çš„è¿è¡Œä¸»æœºã€‚å…·ä½“é…ç½®å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.replication<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="name">value</span>&gt;</span>3<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.name.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">value</span>&gt;</span>/root/hadoop/tmp/name<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.datanode.data.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">value</span>&gt;</span>/root/hadoop/tmp/data<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.secondary.http-address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>node1:8081<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>(4) é…ç½®mapred-site.xmlæ–‡ä»¶<br>
åœ¨mapred-site.xmlæ–‡ä»¶ä¸­ï¼Œä¸»è¦æ˜¯ä¸MapReduceä»»åŠ¡çš„ç›¸å…³é…ç½®ã€‚å…¶ä¸­è¦é…ç½®MapReduceä½¿ç”¨çš„èµ„æºè°ƒåº¦æ¡†æ¶ï¼Œè¿™é‡Œé»˜è®¤æ˜¯yarnã€‚å¦å¤–è¿˜è¦å¯¹mapä»»åŠ¡å’Œreduceä»»åŠ¡æ‰§è¡Œæ—¶çš„å¯ç”¨èµ„æºå’Œjavaè™šæ‹Ÿæœºçš„èµ„æºè¿›è¡Œé…ç½®ã€‚å…·ä½“é…ç½®å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.framework.name<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>yarn<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.map.memory.mb<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>1600<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.reduce.memory.mb<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>1600<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.map.java.opts<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>-Xmx1300m<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.reduce.java.opts<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>-Xmx1300m<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>(5) é…ç½®yarn-site.xmlæ–‡ä»¶<br>
åœ¨yarn-site.xmlæ–‡ä»¶ä¸­ï¼Œå¯ä»¥å¯¹resourcemanagerè¿è¡Œçš„ä¸»æœºè¿›è¡ŒæŒ‡å®šï¼Œè¿™é‡Œæˆ‘å°†å…¶æ”¾åœ¨MasterèŠ‚ç‚¹node1ä¸Šè¿è¡Œï¼Œç”¨äºå¯¹é›†ç¾¤ä¸­çš„ä½œä¸šè¿›è¡Œä»»åŠ¡è°ƒåº¦å’Œèµ„æºåˆ†é…ã€‚ç”±äºæˆ‘æ‰€åˆ›å»ºçš„ä¸‰ä¸ªè™šæ‹Ÿæœºä¸Šåœ¨æˆ‘çš„å•ä¸ªçœŸå®ä¸»æœºä¸Šçš„ï¼Œå› æ­¤å¯ç”¨èµ„æºæ˜¯éå¸¸ç´§å¼ çš„ï¼Œè¿™è¦æ±‚æˆ‘ä¸åŒç›´æ¥ä½¿ç”¨é»˜è®¤é…ç½®ï¼Œè€Œå¿…é¡»å¯¹yarnä¸Šçš„èµ„æºè¿›è¡Œæ›´ä¸ºç»†è‡´åŒ–çš„é‡æ–°åˆ†é…ã€‚</p>
<p>é¦–å…ˆéœ€è¦ç”¨æˆ·é…ç½®æ¯ä¸ªèŠ‚ç‚¹ä¸Šå¯ç”¨çš„ç‰©ç†å†…å­˜èµ„æºå’ŒCPUæ ¸æ•°ï¼Œå› ä¸ºä¸€ä¸ªnodeè®¡ç®—èŠ‚ç‚¹é™¤äº†è·‘ç›¸å…³ä½œä¸šå¤–ï¼Œè¿˜å¯èƒ½è¿è¡Œç€å…¶ä»–åº”ç”¨å’ŒæœåŠ¡ç­‰ã€‚ä¸‹ä¸€æ­¥éœ€è¦å¯¹yarnä¸­å¯è°ƒåº¦çš„å•ä¸ªå®¹å™¨èµ„æºè¿›è¡Œé…ç½®ï¼Œå¦‚é…ç½®è°ƒåº¦çš„æœ€å°åˆ†é…å†…å­˜å’Œæœ€å¤§åˆ†é…å†…å­˜ï¼Œå…¶ä¸­æœ€å°åˆ†é…å†…å­˜å†³å®šç€è¯¥èŠ‚ç‚¹ä¸Šæœ€å¤šå¯éƒ¨ç½²çš„å®¹å™¨ä¸ªæ•°ï¼Œå¯é€šè¿‡yarnå¯ç”¨çš„ç‰©ç†å†…å­˜é™¤ä»¥æ¯ä¸ªå®¹å™¨æœ€å°å¯åˆ†é…çš„å†…å­˜æ¥å¾—åˆ°å®¹å™¨ä¸ªæ•°ï¼ŒåŒç†CPUæ ¸æ•°ä¹Ÿæ˜¯è¿™æ ·æ¥æŒ‡å®šã€‚</p>
<p>æ¥ç€è¿˜éœ€è¦å®šä¹‰æ¯ä¸ªMapå’ŒReduceä»»åŠ¡éœ€è¦çš„æœ€å¤§å†…å­˜é‡ã€‚ç”±äºæ¯ä¸ªMapå’Œæ¯ä¸ªReduceéƒ½å°†åœ¨å•ç‹¬çš„Containerä¸­è¿è¡Œï¼Œå› æ­¤è¿™äº›æœ€å¤§å†…å­˜è®¾ç½®åº”è‡³å°‘ç­‰äºæˆ–å¤§äºYARNæœ€å°Containerå®¹é‡åˆ†é…ã€‚æœ€åï¼Œæ¯ä¸ªMapå’ŒReduceä»»åŠ¡çš„è™šæ‹Ÿå†…å­˜ï¼ˆç‰©ç†+åˆ†é¡µå†…å­˜ï¼‰ä¸Šé™ç”±æ¯ä¸ªå…è®¸YARNå®¹å™¨çš„è™šæ‹Ÿå†…å­˜æ¯”å†³å®šï¼Œé»˜è®¤å€¼ä¸º2.1ã€‚å…·ä½“çš„é…ç½®ç»†èŠ‚å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.hostname<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">value</span>&gt;</span>node1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.aux-services<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>mapreduce_shuffle<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.resource.memory-mb<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>2500<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.resource.vcores<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>4<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		 <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.scheduler.minimum-allocation-mb<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		 <span class="tag">&lt;<span class="name">value</span>&gt;</span>2000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.scheduler.maximum-allocation-mb<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>2500<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.scheduler.minimum-allocation-vcores<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.scheduler.maximum-allocation-vcores<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>4<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.scheduler.increment-allocation-mb<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>100<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.scheduler.increment-allocation-vcores<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.app.mapreduce.am.resource.mb<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>300<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.vmem-pmem-ratio<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>4<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.vmem-check-enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>(6) SSHå…å¯†ç™»é™†é…ç½®<br>
åœ¨é…ç½®SSHå…å¯†ç™»é™†æ—¶ï¼Œä¸»è¦å¯¹é’ˆå¯¹Masterèƒ½å…å¯†ç™»é™†åˆ°å„ä¸ªslaveèŠ‚ç‚¹ä¸Šï¼Œä¿è¯NameNodeå’ŒResourceManageræœåŠ¡èƒ½åœ¨é›†ç¾¤çš„å„ä¸ªèŠ‚ç‚¹ä¸Šè¿›è¡Œä¾¿æºè®¿é—®ã€‚åœ¨æˆ‘çš„åˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼Œç”±äºNNå’ŒRMéƒ½æ˜¯è¿è¡Œåœ¨ä¸»èŠ‚ç‚¹node1ä¸Šï¼Œå› æ­¤æˆ‘éœ€è¦é…ç½®node1åˆ°node2å’Œnode3çš„å…å¯†ç™»é™†ã€‚å…·ä½“æ“ä½œï¼šåœ¨node1ä¸Šä½¿ç”¨å‘½ä»¤â€œssh-keygen â€“t rsaâ€ç”Ÿæˆnode1çš„å¯†é’¥å¯¹ï¼Œå¹¶å°†node1çš„å…¬é’¥åˆ†åˆ«å‘é€åˆ°node2å’Œnode3çš„~/.ssh/authorizedæ–‡ä»¶ä¸­ï¼Œå³å¯å®ç°SSHå…å¯†ç™»é™†ã€‚</p>
<h3 id="4-3-3-å¯åŠ¨å’Œåœæ­¢hadoopé›†ç¾¤">4.3.3 å¯åŠ¨å’Œåœæ­¢Hadoopé›†ç¾¤</h3>
<p>å®Œå…¨åˆ†å¸ƒå¼å’Œä¼ªåˆ†å¸ƒå¼ä¸€æ ·ï¼Œ<a href="http://xn--start-dfs-zo31ac0a.sh" target="_blank" rel="noopener">é€šè¿‡start-dfs.sh</a>ã€<a href="http://start-yarn.xn--shstop-dfs-ih7q.sh" target="_blank" rel="noopener">start-yarn.shå’Œstop-dfs.sh</a>ã€stop-yarn.shè„šæœ¬ï¼Œå¯åŠ¨æˆ–è€…åœæ­¢å¦‚hdfsã€yarnæˆ–è€…æ—¥å¿—èšåˆç­‰æœåŠ¡è¿›ç¨‹ã€‚ä¸‹é¢æ˜¯åœ¨æˆ‘çš„å®Œå…¨åˆ†å¸ƒå¼é›†ç¾¤ä¸­çš„å¯åŠ¨å®ä¾‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@node1:~# start-dfs.sh &amp;&amp; start-yarn.sh</span><br><span class="line">Starting namenodes on [node1]</span><br><span class="line">node1: starting namenode, logging to /root/hadoop/logs/hadoop-root-namenode-node1.out</span><br><span class="line">node2: starting datanode, logging to /root/hadoop/logs/hadoop-root-datanode-node2.out</span><br><span class="line">node3: starting datanode, logging to /root/hadoop/logs/hadoop-root-datanode-node3.out</span><br><span class="line">node1: starting datanode, logging to /root/hadoop/logs/hadoop-root-datanode-node1.out</span><br><span class="line">Starting secondary namenodes [node1]</span><br><span class="line">node1: starting secondarynamenode, logging to /root/hadoop/logs/hadoop-root-secondarynamenode-node1.out</span><br><span class="line">starting yarn daemons</span><br><span class="line">starting resourcemanager, logging to /root/hadoop/logs/yarn-root-resourcemanager-node1.out</span><br><span class="line">node3: starting nodemanager, logging to /root/hadoop/logs/yarn-root-nodemanager-node3.out</span><br><span class="line">node2: starting nodemanager, logging to /root/hadoop/logs/yarn-root-nodemanager-node2.out</span><br><span class="line">node1: starting nodemanager, logging to /root/hadoop/logs/yarn-root-nodemanager-node1.out</span><br></pre></td></tr></table></figure>
<p>ä»ä¸Šé¢æ‰“å°çš„ä¿¡æ¯å¯ä»¥çœ‹å‡ºï¼ŒNameNodeæ˜¯è¿è¡Œåœ¨node1ä¸»èŠ‚ç‚¹ä¸Šçš„ï¼Œåœ¨é›†ç¾¤ä¸­çš„ä¸‰ä¸ªèŠ‚ç‚¹éƒ½ä½œä¸ºè®¡ç®—èŠ‚ç‚¹è¿è¡Œè¿™DataNodeè¿›ç¨‹å’ŒNodeManagerè¿›ç¨‹ã€‚</p>
<h2 id="4-4-åˆ†å¸ƒå¼ç¯å¢ƒä¸‹mapreduceä½œä¸šæ„å»º">4.4 åˆ†å¸ƒå¼ç¯å¢ƒä¸‹MapReduceä½œä¸šæ„å»º</h2>
<p><img src="https://i.imgur.com/SdyGul2.png" alt="å›¾4-6 åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„MapReduceçš„æµç¨‹"></p>
<p>åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼Œä¸ä¼ªåˆ†å¸ƒå¼ä¸åŒçš„åœ°æ–¹åœ¨äºï¼Œå¤šä¸ªslaveèŠ‚ç‚¹å¯ä»¥æä¾›å¤šä¸ªcontainerå®¹å™¨ä¾›MapReduceä»»åŠ¡æ¥è¿è¡Œï¼Œåˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„MapReduceçš„æµç¨‹æ„é€ å¦‚å›¾4-6æ‰€ç¤ºã€‚</p>
<p>ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œåœ¨å®Œå…¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­æ€»å…±æœ‰å¤šä¸ªè®¡ç®—èŠ‚ç‚¹ï¼Œå…¶ä¸­åŒ…å«å¤šä¸ªcontainerå®¹å™¨ï¼Œè€Œæˆ‘ä»¬æäº¤çš„Mapä½œä¸šå’ŒReduceä½œä¸šå°±æ˜¯åœ¨å¤šä¸ªå®¹å™¨ä¸­åˆ†åˆ«è¿›è¡Œè¿ç®—ï¼Œæœ€åå†å°†Mapä½œä¸šè¿è¡Œçš„ç»“æœé€šè¿‡ä¸€ä¸ªReduceä½œä¸šè¿›è¡Œè§„çº¦è®¡ç®—ã€‚æ•´ä¸ªMapReduceè¿è¡Œæµç¨‹ï¼Œç”±åŸæ¥çš„ä¼ªåˆ†å¸ƒå¼ä¸­ä¸²è¡Œè¿ç®—Mapä½œä¸šå’ŒReduceä½œä¸šï¼Œåˆ°ç°åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­å¹¶è¡Œè¿ç®—Mapä½œä¸šï¼Œæœ€åå°†Mapçš„ä¸­é—´ç»“æœç”¨ä¸€ä¸ªReduceä½œä¸šæ¥å¤„ç†ã€‚</p>
<h2 id="4-5-shellè„šæœ¬æ‰§è¡Œå¼•æ“çš„æ„å»º">4.5 Shellè„šæœ¬æ‰§è¡Œå¼•æ“çš„æ„å»º</h2>
<p>åœ¨å¾—åˆ°æœ€ç»ˆçš„æ‰§è¡Œè„šæœ¬åï¼Œè¿˜éœ€è¦é€šè¿‡ç‰¹å®šçš„æ–¹æ³•æ¥è°ƒç”¨æ‰§è¡Œè¯¥è„šæœ¬æ–‡ä»¶ã€‚é€šè¿‡ç¼–å†™ShellScriptUtilå·¥å…·ç±»ï¼Œæ‰§è¡ŒæŒ‡å®šçš„è„šæœ¬å¹¶æ‰“å°æ‰§è¡Œè¿‡ç¨‹ä¸­å‡ºç°çš„æ—¥å¿—ï¼Œå¹¶å­˜æ”¾åœ¨æŒ‡å®šçš„è·¯å¾„ä¸‹ï¼Œä¸‹é¢æ˜¯shellè„šæœ¬æ‰§è¡Œå·¥å…·ç±»çš„ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * shellè„šæœ¬å·¥å…·åŒ…</span></span><br><span class="line"><span class="comment">* ç”¨äºå°†ä¸€ä¸ªæŒ‡å®šçš„å¯æ‰§è¡Œè„šæœ¬è¿›è¡Œæ‰§è¡Œçš„Javaç¨‹åº</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShellScriptUtil</span> </span>&#123;</span><br><span class="line">    <span class="comment">// æ—¥å¿—è®°å½•</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Logger theLogger = Logger.getLogger(TemplateEngine.class.getName());</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è°ƒç”¨Shellè„šæœ¬æ‰§è¡Œçš„æ–¹æ³•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> paths æŒ‡å®šå¤šä¸ªè·¯å¾„å‚æ•°</span></span><br><span class="line"><span class="comment">     *              ç¬¬ä¸€ä¸ªæŒ‡å®šçš„æ˜¯shellæ¨¡ç‰ˆ</span></span><br><span class="line"><span class="comment">     *              ç¬¬äºŒä¸ªå‚æ•°æŒ‡å®šçš„æ˜¯è„šæœ¬æ‰§è¡Œç»“æœå­˜æ”¾è·¯å¾„</span></span><br><span class="line"><span class="comment">     *              ç¬¬ä¸‰ä¸ªå‚æ•°æŒ‡å®šçš„æ˜¯æ‰§è¡Œè„šæœ¬ä¸­æ—¥å¿—å­˜æ”¾è·¯å¾„ï¼Œæ˜¯å¯é€‰å‚æ•°ï¼Œæœªç»™å‡ºæ­¤å‚æ•°åˆ™é»˜è®¤ä¸ºæ— æ—¥å¿—è¾“å‡º</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">callProcess</span><span class="params">(String... paths)</span> </span>&#123;</span><br><span class="line">        File outputFile;</span><br><span class="line">        File logFile;</span><br><span class="line">        Process process;</span><br><span class="line">        String scriptPath = paths[<span class="number">0</span>];</span><br><span class="line">        String chmod = <span class="string">"chmod u+x "</span> + scriptPath;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// ä¸ºshellè„šæœ¬å¢åŠ å¯æ‰§è¡Œæƒé™</span></span><br><span class="line">            Runtime.getRuntime().exec(chmod).waitFor();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"æ‰§è¡Œè„šæœ¬ï¼š"</span> + scriptPath);</span><br><span class="line">        ProcessBuilder pb = <span class="keyword">new</span> ProcessBuilder(<span class="string">"./"</span> + scriptPath);</span><br><span class="line">        pb.inheritIO();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æŒ‡å®šshellè„šæœ¬æ‰§è¡Œçš„ç»“æœè¾“å‡ºè·¯å¾„å’Œæ‰§è¡Œæ—¶æ—¥å¿—æ–‡ä»¶çš„è¾“å‡ºè·¯å¾„</span></span><br><span class="line">        <span class="keyword">if</span> (paths.length == <span class="number">3</span>) &#123;</span><br><span class="line">            outputFile = <span class="keyword">new</span> File(paths[<span class="number">1</span>]);</span><br><span class="line">            pb.redirectOutput(outputFile);</span><br><span class="line">            logFile = <span class="keyword">new</span> File(paths[<span class="number">2</span>]);</span><br><span class="line">            pb.redirectError(logFile);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æŒ‡å®šshellè„šæœ¬æ‰§è¡Œçš„æ—¥å¿—è¾“å‡ºè·¯å¾„</span></span><br><span class="line">        <span class="keyword">if</span> (paths.length == <span class="number">2</span>) &#123;</span><br><span class="line">            logFile = <span class="keyword">new</span> File(paths[<span class="number">1</span>]);</span><br><span class="line">            <span class="keyword">if</span> (logFile.exists()) &#123;</span><br><span class="line">                logFile.delete();</span><br><span class="line">            &#125;</span><br><span class="line">            pb.redirectError(logFile);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            process = pb.start();</span><br><span class="line">            process.waitFor();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            theLogger.error(<span class="string">"å‘ç”ŸI/Oé”™è¯¯..."</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            theLogger.error(<span class="string">"å½“å‰çº¿ç¨‹åœ¨ç­‰å¾…æ—¶è¢«å¦ä¸€ä¸ªçº¿ç¨‹ä¸­æ–­..."</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="4-6-mapreduceä½œä¸šç¼–å†™ä¸æ•´ä½“è°ƒåº¦">4.6 MapReduceä½œä¸šç¼–å†™ä¸æ•´ä½“è°ƒåº¦</h2>
<p>åœ¨MapReduceè®¡ç®—æ¡†æ¶ä¸­ï¼Œé€šè¿‡Mapperå’ŒReduceræ¥æ•´ä½“è°ƒåº¦æ•´ä¸ªWGSåˆ†ææµç¨‹ï¼Œè¿™é‡Œéœ€è¦è‡ªå®šä¹‰map()å‡½æ•°å’Œreduce()å‡½æ•°ã€‚å…¶ä¸­map()å‡½æ•°æ˜¯ç”¨æ¥ä¼ å…¥è¦åˆ†æçš„æ ·æœ¬åç§°ï¼Œå¹¶é€šè¿‡æ ·æœ¬åç§°å¯¹ä¸åŒçš„æ ·æœ¬åˆ†å¤šä¸ªmapä»»åŠ¡æ¥å¹¶è¡Œæ‰§è¡Œï¼Œä»è€Œè°ƒç”¨æ¨¡æ¿ç±»ï¼Œå¹¶æ‰§è¡Œæœ€ç»ˆçš„WGSåˆ†æè„šæœ¬ã€‚ä¸‹é¢æ˜¯wgsMapperç±»çš„ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    ç¼–å†™å…¨åŸºå› ç»„æµ‹åºçš„Mapperç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">wgsMapper</span> <span class="keyword">extends</span> <span class="title">Mapper</span>&lt;<span class="title">LongWritable</span>, <span class="title">Text</span>, <span class="title">Text</span>, <span class="title">Text</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String LOG_DIRECTORY = <span class="string">"./wgs-logs"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String SCRIPT_DIRECTORY = <span class="string">"./wgs-scripts"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">map</span><span class="params">(LongWritable key, Text value, Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line"></span><br><span class="line">        String sample_name = value.toString();</span><br><span class="line">        wgs(sample_name);</span><br><span class="line">        context.write(<span class="keyword">new</span> Text(<span class="string">"1"</span>),<span class="keyword">new</span> Text(sample_name));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">wgs</span><span class="params">(String sampleName)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        HashMap&lt;String, String&gt; templateMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        templateMap.put(<span class="string">"sample_name"</span>, sampleName);</span><br><span class="line"></span><br><span class="line">        String template = <span class="string">"wgsMapper.template"</span>;</span><br><span class="line">        String scriptPath = SCRIPT_DIRECTORY + <span class="string">"/wgs_mapper_"</span> + templateMap.get(<span class="string">"sample_name"</span>) + <span class="string">".sh"</span>;</span><br><span class="line">        String logPath = LOG_DIRECTORY + <span class="string">"/wgs_mapper_"</span> + templateMap.get(<span class="string">"sample_name"</span>) + <span class="string">".log"</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä»æ¨¡æ¿åˆ›å»ºå…·ä½“è„šæœ¬</span></span><br><span class="line">        File scriptFile = TemplateEngine.createDynamicContentAsFile(template, templateMap, scriptPath);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (scriptFile != <span class="keyword">null</span>) &#123;</span><br><span class="line">            ShellScriptUtil.callProcess(scriptPath, logPath);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è€Œåœ¨reduce()å‡½æ•°ä¸­ï¼Œé€šè¿‡ä¼ é€’çš„æ ·æœ¬åç§°åˆ°Reducerè„šæœ¬æ¨¡ç‰ˆä¸­ï¼Œå¯¹æŒ‡å®šçš„gvcfæ–‡ä»¶ä½œåˆå¹¶å¤„ç†ï¼Œä»è€Œå¾—åˆ°æœ€ç»ˆçš„VCFæ–‡ä»¶ã€‚ä¸‹é¢æ˜¯wgsReducerç±»çš„ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    ç¼–å†™å…¨åŸºå› ç»„æµ‹åºçš„Reducerç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">wgsReducer</span> <span class="keyword">extends</span> <span class="title">Reducer</span>&lt;<span class="title">Text</span>, <span class="title">Text</span>, <span class="title">Text</span>, <span class="title">Text</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String LOG_DIRECTORY = <span class="string">"./wgs-logs"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String SCRIPT_DIRECTORY = <span class="string">"./wgs-scripts"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">reduce</span><span class="params">(Text key, Iterable&lt;Text&gt; values, Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line"></span><br><span class="line">        HashMap&lt;String, String&gt; templateMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        Iterator&lt;Text&gt; value = values.iterator();</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">        String str = <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">while</span> (value.hasNext()) &#123;</span><br><span class="line">            str = value.next().toString();</span><br><span class="line">            templateMap.put(<span class="string">"sample_name"</span> + (++count), str);</span><br><span class="line">        &#125;</span><br><span class="line">        mergeGVCF(templateMap);</span><br><span class="line">        context.write(<span class="keyword">new</span> Text(<span class="string">"1"</span>), <span class="keyword">new</span> Text(str));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">mergeGVCF</span><span class="params">(HashMap&lt;String, String&gt; templateMap)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        String template = <span class="string">"wgsReducer.template"</span>;</span><br><span class="line">        String scriptPath = SCRIPT_DIRECTORY + <span class="string">"/wgs_reducer_"</span> + <span class="string">".sh"</span>;</span><br><span class="line">        String logPath = LOG_DIRECTORY + <span class="string">"/wgs_reducer_"</span> + <span class="string">".log"</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä»æ¨¡æ¿åˆ›å»ºå…·ä½“è„šæœ¬</span></span><br><span class="line">        File scriptFile = TemplateEngine.createDynamicContentAsFile(template, templateMap, scriptPath);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (scriptFile != <span class="keyword">null</span>) &#123;</span><br><span class="line">            ShellScriptUtil.callProcess(scriptPath, logPath);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="4-7-æœ¬ç« å°ç»“">4.7 æœ¬ç« å°ç»“</h2>
<p>åœ¨æœ¬ç« ä¸­ï¼Œä¸»è¦ä»‹ç»äº†Hadoopä¼ªåˆ†å¸ƒå¼ç¯å¢ƒåŠåˆ†å¸ƒå¼ç¯å¢ƒè¿›è¡Œæ­å»ºï¼Œè¿˜å¯¹WGSåˆ†ææµç¨‹ä¸MapReduceè®¡ç®—æ¡†æ¶å¦‚ä½•ç»“åˆèµ·æ¥ï¼Œå…¶ä¸­å°±æ¶‰åŠåˆ°å¦‚ä½•åˆ†å¤šä¸ªmapä»»åŠ¡å¹¶è¡Œæ‰§è¡Œåˆ†ææµç¨‹ï¼Œå¯¹äºWGSæµ‹åºè¿‡ç¨‹åœ¨linuxç¯å¢ƒä¸­è¿è¡Œçš„æƒ…å†µï¼Œå¼•å…¥FreeMarkerç¬¬ä¸‰æ–¹åº“ï¼Œé€šè¿‡ç¼–å†™è„šæœ¬æ¨¡æ¿ï¼Œå¹¶ç»“åˆmapå’Œreduceä½œä¸šï¼Œä½¿å¾—ä¸åŒçš„mapæˆ–è€…reduceä»»åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä»¥ä¸åŒçš„æ ·æœ¬æ•°æ®æ¥æ‰§è¡Œä¸åŒçš„WGSè„šæœ¬ï¼Œè¾¾åˆ°é«˜æ•ˆå¹¶è¡ŒåŒ–çš„å…¨åŸºå› ç»„æµ‹åºçš„ç›®çš„ï¼Œæœ€åå†é€šè¿‡è°ƒç”¨Driveré©±åŠ¨ç±»æ‰§è¡Œæ•´ä¸ªMapReduceç¨‹åºã€‚</p>
<p>ä¸‹ä¸€ç« ä¸»è¦å¯¹æ„å»ºçš„æµ‹åºå¹³å°åšä¸€ä¸ªå¤šæ ·æœ¬æ•°æ®çš„æµ‹è¯•ï¼Œå¹¶è¿›è¡Œä¼˜åŒ–å’Œç³»ç»Ÿæ‰©å±•ã€‚</p>
<hr class="footnotes-sep">
<section class="footnotes">
<ol class="footnotes-list">
<li id="fn1" class="footnote-item"><p>Tom White. Hadoopæƒå¨æŒ‡å—[M]. ç‹æµ·,åä¸œ,åˆ˜å–»,å•ç²¤æµ·è¯‘. æ¸…åå¤§å­¦å‡ºç‰ˆç¤¾ ç¬¬å››ç‰ˆ 2017. <a href="#fnref1" class="footnote-backref">â†©</a></p>
</li>
</ol>
</section>

      
    </div>

    
      

    

    <footer class="article-footer">
      <a data-url="https://longshilin.com/blog/3fd0f93f.html" data-id="cjocvdhr600100lu10rif4ybc" class="article-share-link">
        <i class="fa fa-share"></i> åˆ†äº«
      </a>

      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/Hadoop/">Hadoop</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/åŸºå› æµ‹åº/">åŸºå› æµ‹åº</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/å¤§æ•°æ®/">å¤§æ•°æ®</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/æ¯•ä¸šè®¾è®¡/">æ¯•ä¸šè®¾è®¡</a></li></ul>


    </footer>
  </div>
  
    
<ul id="article-nav" class="nav nav-pills nav-justified">
  
  <li role="presentation">
    <a href="/blog/34f6c0b5.html" id="article-nav-older" class="article-nav-link-wrap">
      <i class="fa fa-chevron-left pull-left"></i>
      <span class="article-nav-link-title">3 åŸºäºHadoopåŸºå› æµ‹åºæ•°æ®å¤„ç†å…³é”®æŠ€æœ¯çš„ç ”ç©¶</span>
    </a>
  </li>
  
  
  <li role="presentation">
    <a href="/blog/c7060cce.html" id="article-nav-newer" class="article-nav-link-wrap">
      <span class="article-nav-link-title">5 ç³»ç»Ÿçš„æµ‹è¯•ä¸æ‰©å±•</span>
      <i class="fa fa-chevron-right pull-right"></i>
    </a>
  </li>
  
</ul>


  
</article>


<section id="comments">
  
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments.</a></noscript>
    </div>
  
</section>



        </div>
        <div class="col-sm-3 col-sm-offset-1 blog-sidebar" id="sidebar">
          
  <div class="sidebar-module sidebar-toc" id="toc">
    
      <h4>Table of Contents</h4>
      <ol class="sidebar-module-list"><li class="sidebar-module-list-item sidebar-module-list-level-2"><a class="sidebar-module-list-link" href="#4-1-åŸºäºhadoopçš„ä¼ªåˆ†å¸ƒå¼å¹³å°æ­å»º"><span class="sidebar-module-list-number">1.</span> <span class="sidebar-module-list-text">4.1 åŸºäºHadoopçš„ä¼ªåˆ†å¸ƒå¼å¹³å°æ­å»º</span></a><ol class="sidebar-module-list-child"><li class="sidebar-module-list-item sidebar-module-list-level-3"><a class="sidebar-module-list-link" href="#4-1-1-æ­å»ºhadoopä¼ªåˆ†å¸ƒå¼å¹³å°"><span class="sidebar-module-list-number">1.1.</span> <span class="sidebar-module-list-text">4.1.1 æ­å»ºHadoopä¼ªåˆ†å¸ƒå¼å¹³å°</span></a></li><li class="sidebar-module-list-item sidebar-module-list-level-3"><a class="sidebar-module-list-link" href="#4-1-2-å¯åŠ¨å’Œåœæ­¢hadoopé›†ç¾¤"><span class="sidebar-module-list-number">1.2.</span> <span class="sidebar-module-list-text">4.1.2 å¯åŠ¨å’Œåœæ­¢Hadoopé›†ç¾¤</span></a></li></ol></li><li class="sidebar-module-list-item sidebar-module-list-level-2"><a class="sidebar-module-list-link" href="#4-2-ä¼ªåˆ†å¸ƒå¼ç¯å¢ƒçš„mapreduceä½œä¸šæ„å»º"><span class="sidebar-module-list-number">2.</span> <span class="sidebar-module-list-text">4.2 ä¼ªåˆ†å¸ƒå¼ç¯å¢ƒçš„MapReduceä½œä¸šæ„å»º</span></a><ol class="sidebar-module-list-child"><li class="sidebar-module-list-item sidebar-module-list-level-3"><a class="sidebar-module-list-link" href="#4-2-1-mapperæµç¨‹æ„é€ "><span class="sidebar-module-list-number">2.1.</span> <span class="sidebar-module-list-text">4.2.1 Mapperæµç¨‹æ„é€ </span></a></li><li class="sidebar-module-list-item sidebar-module-list-level-3"><a class="sidebar-module-list-link" href="#4-2-2-reduceræµç¨‹æ„é€ "><span class="sidebar-module-list-number">2.2.</span> <span class="sidebar-module-list-text">4.2.2 Reduceræµç¨‹æ„é€ </span></a></li><li class="sidebar-module-list-item sidebar-module-list-level-3"><a class="sidebar-module-list-link" href="#4-3-2-hadoopå®Œå…¨åˆ†å¸ƒå¼é…ç½®"><span class="sidebar-module-list-number">2.3.</span> <span class="sidebar-module-list-text">4.3.2 Hadoopå®Œå…¨åˆ†å¸ƒå¼é…ç½®</span></a></li><li class="sidebar-module-list-item sidebar-module-list-level-3"><a class="sidebar-module-list-link" href="#4-3-3-å¯åŠ¨å’Œåœæ­¢hadoopé›†ç¾¤"><span class="sidebar-module-list-number">2.4.</span> <span class="sidebar-module-list-text">4.3.3 å¯åŠ¨å’Œåœæ­¢Hadoopé›†ç¾¤</span></a></li></ol></li><li class="sidebar-module-list-item sidebar-module-list-level-2"><a class="sidebar-module-list-link" href="#4-4-åˆ†å¸ƒå¼ç¯å¢ƒä¸‹mapreduceä½œä¸šæ„å»º"><span class="sidebar-module-list-number">3.</span> <span class="sidebar-module-list-text">4.4 åˆ†å¸ƒå¼ç¯å¢ƒä¸‹MapReduceä½œä¸šæ„å»º</span></a></li><li class="sidebar-module-list-item sidebar-module-list-level-2"><a class="sidebar-module-list-link" href="#4-5-shellè„šæœ¬æ‰§è¡Œå¼•æ“çš„æ„å»º"><span class="sidebar-module-list-number">4.</span> <span class="sidebar-module-list-text">4.5 Shellè„šæœ¬æ‰§è¡Œå¼•æ“çš„æ„å»º</span></a></li><li class="sidebar-module-list-item sidebar-module-list-level-2"><a class="sidebar-module-list-link" href="#4-6-mapreduceä½œä¸šç¼–å†™ä¸æ•´ä½“è°ƒåº¦"><span class="sidebar-module-list-number">5.</span> <span class="sidebar-module-list-text">4.6 MapReduceä½œä¸šç¼–å†™ä¸æ•´ä½“è°ƒåº¦</span></a></li><li class="sidebar-module-list-item sidebar-module-list-level-2"><a class="sidebar-module-list-link" href="#4-7-æœ¬ç« å°ç»“"><span class="sidebar-module-list-number">6.</span> <span class="sidebar-module-list-text">4.7 æœ¬ç« å°ç»“</span></a></li></ol>
    
  </div>



  <div class="sidebar-module sidebar-module-inset">
  <h4>About</h4>
  Shilin Long (<a href="https://weibo.com/longsl123">@æ‰¶æˆ‘èµ·æ¥-è¿˜èƒ½æµª</a>) is a DevOps engineer and live in Shanghai.<br> <a href="/blog/about/">Read more Â»</a>
</div>


  
<div class="sidebar-module sidebar-tags">
  <h4>Search</h4>
  <form id="search-form"> <!-- æœç´¢æ¡†ç›¸å…³ -->
    <input type="text" id="local-search-input" name="q" placeholder=" æœä¸€æœ..." class="search form-control" autocomplete="off" autocorrect="off" searchonload="false">
    <i class="fa fa-times" onclick="resetSearch()"></i> <!-- æ¸…ç©º/é‡ç½®æœç´¢æ¡† -->
  </form>
  <div id="local-search-result"></div> <!-- æœç´¢ç»“æœåŒº -->
  <p class="no-result">No results found </p> <!-- æ— åŒ¹é…æ—¶æ˜¾ç¤ºï¼Œæ³¨æ„è¯·åœ¨ CSS ä¸­è®¾ç½®é»˜è®¤éšè— -->
</div>



  
  <div class="sidebar-module">
    <h4>Categories</h4>
    <ul class="sidebar-module-list"><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/blog/categories/90km/">90km</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/blog/categories/HadoopåŸºå› æµ‹åº/">HadoopåŸºå› æµ‹åº</a><span class="sidebar-module-list-count">9</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/blog/categories/Java/">Java</a><span class="sidebar-module-list-count">7</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/blog/categories/OpensourceTools/">OpensourceTools</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/blog/categories/Tech/">Tech</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/blog/categories/aws/">aws</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/blog/categories/docker/">docker</a><span class="sidebar-module-list-count">3</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/blog/categories/jenkins/">jenkins</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/blog/categories/kubernetes/">kubernetes</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/blog/categories/website/">website</a><span class="sidebar-module-list-count">9</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/blog/categories/ä¹¦ç±/">ä¹¦ç±</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/blog/categories/å†™ä½œ/">å†™ä½œ</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/blog/categories/å­¦ä¹ èµ„æº/">å­¦ä¹ èµ„æº</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/blog/categories/æ¯æ—¥è®¡åˆ’/">æ¯æ—¥è®¡åˆ’</a><span class="sidebar-module-list-count">17</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/blog/categories/è‡ªæˆ‘é©±åŠ¨/">è‡ªæˆ‘é©±åŠ¨</a><span class="sidebar-module-list-count">1</span></li></ul>
  </div>



  
  <div class="sidebar-module">
    <h4>Tag Cloud</h4>
    <p class="tagcloud">
      <a href="/blog/tags/90km/" style="font-size: 10px;">90km</a> <a href="/blog/tags/CI-CD/" style="font-size: 12px;">CI/CD</a> <a href="/blog/tags/Class/" style="font-size: 10px;">Class</a> <a href="/blog/tags/Hadoop/" style="font-size: 18px;">Hadoop</a> <a href="/blog/tags/SEO/" style="font-size: 10px;">SEO</a> <a href="/blog/tags/StackOverflow/" style="font-size: 10px;">StackOverflow</a> <a href="/blog/tags/aws/" style="font-size: 12px;">aws</a> <a href="/blog/tags/aws-soa/" style="font-size: 10px;">aws-soa</a> <a href="/blog/tags/docker/" style="font-size: 14px;">docker</a> <a href="/blog/tags/gitlab/" style="font-size: 10px;">gitlab</a> <a href="/blog/tags/hexo/" style="font-size: 12px;">hexo</a> <a href="/blog/tags/java/" style="font-size: 12px;">java</a> <a href="/blog/tags/jenkins/" style="font-size: 10px;">jenkins</a> <a href="/blog/tags/k8s/" style="font-size: 10px;">k8s</a> <a href="/blog/tags/learning/" style="font-size: 10px;">learning</a> <a href="/blog/tags/longshilindotcom/" style="font-size: 16px;">longshilindotcom</a> <a href="/blog/tags/markdown/" style="font-size: 10px;">markdown</a> <a href="/blog/tags/memreduct/" style="font-size: 10px;">memreduct</a> <a href="/blog/tags/plan/" style="font-size: 20px;">plan</a> <a href="/blog/tags/simiki/" style="font-size: 10px;">simiki</a> <a href="/blog/tags/sysops/" style="font-size: 10px;">sysops</a> <a href="/blog/tags/tools/" style="font-size: 10px;">tools</a> <a href="/blog/tags/website/" style="font-size: 10px;">website</a> <a href="/blog/tags/wordpress/" style="font-size: 10px;">wordpress</a> <a href="/blog/tags/write/" style="font-size: 10px;">write</a> <a href="/blog/tags/ä»£ç†/" style="font-size: 10px;">ä»£ç†</a> <a href="/blog/tags/ä¼˜ç§€æ–‡ç« /" style="font-size: 10px;">ä¼˜ç§€æ–‡ç« </a> <a href="/blog/tags/åå°„æœºåˆ¶/" style="font-size: 10px;">åå°„æœºåˆ¶</a> <a href="/blog/tags/åŸŸå/" style="font-size: 10px;">åŸŸå</a> <a href="/blog/tags/åŸºå› æµ‹åº/" style="font-size: 18px;">åŸºå› æµ‹åº</a> <a href="/blog/tags/å¤§æ•°æ®/" style="font-size: 18px;">å¤§æ•°æ®</a> <a href="/blog/tags/å¼‚å¸¸/" style="font-size: 10px;">å¼‚å¸¸</a> <a href="/blog/tags/æ¥å£ä¸å†…éƒ¨ç±»/" style="font-size: 10px;">æ¥å£ä¸å†…éƒ¨ç±»</a> <a href="/blog/tags/æå®¢æ—¶é—´/" style="font-size: 10px;">æå®¢æ—¶é—´</a> <a href="/blog/tags/æ¯•ä¸šè®¾è®¡/" style="font-size: 18px;">æ¯•ä¸šè®¾è®¡</a> <a href="/blog/tags/æ³›å‹/" style="font-size: 10px;">æ³›å‹</a> <a href="/blog/tags/ç¬”è¯•/" style="font-size: 10px;">ç¬”è¯•</a> <a href="/blog/tags/ç±»å¯¹è±¡/" style="font-size: 10px;">ç±»å¯¹è±¡</a> <a href="/blog/tags/çº¿ç¨‹/" style="font-size: 10px;">çº¿ç¨‹</a> <a href="/blog/tags/ç»ƒçº§/" style="font-size: 10px;">ç»ƒçº§</a> <a href="/blog/tags/è¯»ä¹¦/" style="font-size: 10px;">è¯»ä¹¦</a> <a href="/blog/tags/è¿­ä»£å™¨/" style="font-size: 10px;">è¿­ä»£å™¨</a> <a href="/blog/tags/é›†åˆ/" style="font-size: 10px;">é›†åˆ</a> <a href="/blog/tags/é©¬äº‘/" style="font-size: 10px;">é©¬äº‘</a>
    </p>
  </div>


  
  <div class="sidebar-module">
    <h4>Archives</h4>
    <ul class="sidebar-module-list"><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/blog/archives/2018/11/">åä¸€æœˆ 2018</a><span class="sidebar-module-list-count">10</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/blog/archives/2018/10/">åæœˆ 2018</a><span class="sidebar-module-list-count">21</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/blog/archives/2018/09/">ä¹æœˆ 2018</a><span class="sidebar-module-list-count">12</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/blog/archives/2018/07/">ä¸ƒæœˆ 2018</a><span class="sidebar-module-list-count">9</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/blog/archives/2017/11/">åä¸€æœˆ 2017</a><span class="sidebar-module-list-count">7</span></li></ul>
  </div>



  
  <div class="sidebar-module sidebar-recents">
    <h4>Recents</h4>
    <ul class="sidebar-module-list">
      
        <li>
          <a href="/blog/c4db1d93.html">è·Ÿç€é™ˆçš“ç¨‹åºå‘˜ç»ƒçº§</a>
        </li>
      
        <li>
          <a href="/blog/bba48856.html">2018-11-11</a>
        </li>
      
        <li>
          <a href="/blog/cca3b8c0.html">2018-11-10</a>
        </li>
      
        <li>
          <a href="/blog/ac643125.html">2018-11-09</a>
        </li>
      
        <li>
          <a href="/blog/db6301b3.html">2018-11-08</a>
        </li>
      
    </ul>
  </div>


  <div class="sidebar-module">
  <h4>Site Visitors</h4>
  <!--<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1274850654'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s19.cnzz.com/z_stat.php%3Fid%3D1274850654%26online%3D1' type='text/javascript'%3E%3C/script%3E"));</script>
  <a href="https://info.flagcounter.com/AO5g"><img src="https://s01.flagcounter.com/count2/AO5g/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_1/flags_0/percent_0/" alt="Flag Counter" border="0"></a>
  -->
  <!-- æ³¨æ„è¿™ä¸ªç«™ç‚¹æŠ€æœ¯ç»Ÿè®¡æ’ä»¶ï¼Œä¸»è¦è¦è®°ä½çš„æ˜¯jXUIæ˜¯å”¯ä¸€æ€§æ ‡å¿—ï¼Œå…¶ä»–æ ·å¼åœ¨imgæ ‡ç­¾çš„srcå¤„å¯ä»¥è‡ªå®šä¹‰ -->
  <a href="https://info.flagcounter.com/jXUI"><img src="https://s01.flagcounter.com/count2/jXUI/bg_FFFFFF/txt_000000/border_FFFFFF/columns_2/maxflags_10/viewers_3/labels_0/pageviews_1/flags_0/percent_0/" alt="Flag Counter" border="0"></a>
</div>





<!--
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-9145047272014077",
    enable_page_level_ads: true
  });
</script>


<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!- blog-general-responsive-sidebar ->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-4721191851305300"
     data-ad-slot="5846920073"
     data-ad-format="auto"></ins>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({});
</script>
-->

        </div>
    </div>
  </div>
  <footer class="blog-footer">
  <div class="container">
    <div id="footer-info" class="inner">
      Copyright &copy; 2014 - 2018 longsl <u><a href="https://longsl.mit-license.org/" target="_blank">MIT License</a></u>
      <br>
        <!-- CNZZç»Ÿè®¡ -->
        <script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1274850654'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s19.cnzz.com/z_stat.php%3Fid%3D1274850654%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>&nbsp; |&nbsp;
        Create with <a href="https://hexo.io">Hexo</a>&nbsp; |&nbsp;
        CI/CD by <a href="https://about.gitlab.com/2015/12/14/getting-started-with-gitlab-and-gitlab-ci/" target="_blank">Gitlab</a>&nbsp; |&nbsp;
        Host on <a href="https://pages.github.com/" target="_blank">Github</a>&nbsp; |&nbsp;
        <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank"><img alt="çŸ¥è¯†å…±äº«è®¸å¯åè®®" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png"></a><br>
        <a href="http://www.miitbeian.gov.cn">æ¹˜ICPå¤‡18009099å·</a>&nbsp; |&nbsp;
        <img src="/images/beian.png"> <a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=43060202000297">æ¹˜å…¬ç½‘å®‰å¤‡ 43060202000297å·</a>
    </div>
  </div>
</footer>

  

<!-- changyan comment -->


<!-- gitment comment -->


<!-- Valine comment -->

  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  <script>
    new Valine({
      av: AV,
  		el: '#disqus_thread',
  		appId: 'pMgClbOyqp0K4AQxpMUJuskE-9Nh9j0Va',
  		appKey: 'CzXcgRguvCJa0EkILaN5F4HX',
  		notify: false,
  		verify: false,
  		avatar: 'mm',
  		placeholder: 'åœ¨æ­¤å¤„å†™ä¸‹ä½ çš„è¯„è®ºå§...'
  	});
  </script>


<script src="/assets/js/jquery.min.js" crossorigin="anonymous"></script>

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>


  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.0.0/styles/github.min.css" integrity="sha384-WtUWHyk39lfUpZQVgokNfSKCJaKAeD6adgLduBLrKTMUuPzFhLtL23y1guFy6lZn" crossorigin="anonymous">
  <script src="/blog/highlight/highlight.pack.js"></script>



  <link rel="stylesheet" href="/blog/fancybox/jquery.fancybox.css">
  <script src="/blog/fancybox/jquery.fancybox.pack.js"></script>




<script src="/blog/js/script.js"></script>
<script src="/blog/js/search.js"></script>

  
	<div id="totop">
	<a title="totop"><img src="/blog/images/scrollup.png"></a>
	</div>
	<script src="/blog/js/totop.js"></script>

  <script src="/blog/js/sidebar.js"></script>
  <script src="/blog/js/baidu_js_push.js"></script>
  <script id="__bs_script__">
    if(location.hostname == "localhost")
        document.write("<script async src='http://HOST:3000/browser-sync/browser-sync-client.js?v=2.26.0'><\/script>".replace("HOST", location.hostname));
  </script>
</body>
</html>
