<article id="post-建站小记/website-on-gitlab" class="article article-type-post" itemscope="" itemprop="blogPost">

  <header class="article-header">
    
  
    <h1 class="article-title" itemprop="name">
      GitLab CI/CD
    </h1>
  


  </header>

  <div class="article-meta">
    
    <div class="article-datetime">
  <a href="/blog/b4ccb03f.html" class="article-date"><time datetime="2018-09-22T00:00:00.000Z" itemprop="datePublished">2018-09-22</time></a>
</div>

    
    
  <div class="article-category">
    <a class="article-category-link" href="/blog/categories/website/">website</a>
  </div>


    
      
        <a href="https://longshilin.com/blog/b4ccb03f.html#disqus_thread" class="article-comment-link">
          <i class="fa fa-comment"></i> 评论
        </a>
      
    
    <!-- <span id="busuanzi_container_page_pv"><i class="fa fa-eye"></i>&nbsp;阅读次数: <span id="busuanzi_value_page_pv"></span>&nbsp;</span> -->
  </div>
  <div class="article-inner">

    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="https://i.imgur.com/BrmSMBD.png" alt="GitLab CI/CD"></p>
<p>在之前的github上搭建静态资源网站的基础上有了新的提升。把原来在本地机器编译的工作，通过gitlab实现自动化编译部署及发布，我只用专注于写作及将写好的内容上传到gitlab上即可。这也是现在最流行的CI/CD理念（持续集成持续发布）。</p>
<a id="more"></a>
<blockquote>
<p>下面着重来说明下我在部署过程中主要过程及填的坑等等，主要是提供一个部署思路和学习路径。</p>
</blockquote>
<h2 id="注册gitlab账号">注册gitlab账号</h2>
<p>在进行此次迁移资源之前，我是没有接触过<a href="https://gitlab.com/" target="_blank" rel="noopener">gitlab</a>的，自己这一块也是现用现学，所以说都是自己需要才会真正去接触它和学习它，好了继续~</p>
<h2 id="官方pages">官方Pages</h2>
<p>在gitlab上，有专门的<a href="https://gitlab.com/pages" target="_blank" rel="noopener">pages页面</a>，这里目前总共有三十种不同的模板，种类还是一应俱全。下面是首页的内容<br>
<img src="https://i.imgur.com/pXS3DgP.png" alt="gitlab pages"></p>
<p>我们的目的是通过官方<a href="https://gitlab.com/pages/hexo" target="_blank" rel="noopener">hexo pages</a>来学习快速入门及部署我们自己的静态网页。</p>
<h2 id="学习yaml">学习YAML</h2>
<p>通过gitlab<a href="https://docs.gitlab.com/ce/ci/yaml/README.html" target="_blank" rel="noopener">YAML官方文档</a>来学习YAML格式，这里我展示下在我的项目中的YAML文件</p>
<pre><code>image: longsl/hexo2simiki

pages:
  cache:
    paths:
    - blog/node_modules/

  script:
    - HOME=/builds/longshilin/longshilindotcom
    - cd blog
    - npm install
    - hexo deploy
    - cp -r blog $HOME/public
    - cd $HOME/wiki
    - simiki g
    - cp -r wiki $HOME/public/
  artifacts:
    paths:
    - public
  only:
  - master
</code></pre>
<p>这里还是比较清晰，容易理解的。上面的YAML文件主要进行的操作时通过longsl/hexo2simiki镜像作为基础环境，并在上面进行项目构建，并将指定的文件目录public作为发布资源进行发布。详细说明：</p>
<ol>
<li>image是本次构建所使用的镜像，这里我使用的是包含hexo和simiki构建工具的自定义镜像，详见<a href="https://longshilin.com/blog/2018/09/22/hexo2simiki/">hexo2simiki</a></li>
<li>pages表示是一个默认的任务</li>
<li>cache表示在该任务下将指定的路径下的文件进项缓存（其实就是在构建开始的时候将上次打包并保存的文件再次拿来用），这样在每次构建并发布时，可以省去很多固定资源的构建开销。</li>
<li>script下面是编写shell脚本，这些脚本命令直接就是在docker容器中执行的，因此如果你的镜像时以linux为基础，可以直接执行。</li>
<li>artifacts是发布项，可以指定本次构建出的哪部分内容会被保留下来，并作为该pipline的发布源文件。</li>
<li>only指的是本次job任务只会涉及到master分支上的内容。</li>
</ol>
<p>更多信息详见 <a href="https://docs.gitlab.com/ce/ci/" target="_blank" rel="noopener">GitLab Continuous Integration</a></p>
<h2 id="部署及发布">部署及发布</h2>
<p>编写自己的.gitlab-ci.yml文件，并放在项目的根目录下，这样在每次有新的更新提交到gitlab上时，会自动触发进行项目构建。</p>

      
    </div>

    
      

    

    <footer class="article-footer">
      <a data-url="https://longshilin.com/blog/b4ccb03f.html" data-id="cjrzqbxkt00310l1f1me030yo" class="article-share-link">
        <i class="fa fa-share"></i> 分享
      </a>

      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/CI-CD/">CI/CD</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/gitlab/">gitlab</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/website/">website</a></li></ul>


    </footer>
  </div>
  
    
<ul id="article-nav" class="nav nav-pills nav-justified">
  
  <li role="presentation">
    <a href="/blog/fd401cf5.html" id="article-nav-older" class="article-nav-link-wrap">
      <i class="fa fa-chevron-left pull-left"></i>
      <span class="article-nav-link-title">构建hexo和simiki工具的docker镜像</span>
    </a>
  </li>
  
  
  <li role="presentation">
    <a href="/blog/112641e9.html" id="article-nav-newer" class="article-nav-link-wrap">
      <span class="article-nav-link-title">有关AWS考证的思考</span>
      <i class="fa fa-chevron-right pull-right"></i>
    </a>
  </li>
  
</ul>


  
</article>


<section id="comments">
  
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments.</a></noscript>
    </div>
  
</section>


